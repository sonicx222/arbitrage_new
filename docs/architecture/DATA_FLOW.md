# Data Flow Architecture

> **Last Updated:** 2026-02-05
> **Version:** 1.0
> **Related:** [ARCHITECTURE_V2.md](ARCHITECTURE_V2.md), [ADR-002](adr/ADR-002-redis-streams.md)

This document visualizes the complete data flow through the arbitrage detection and execution system.

---

## Table of Contents

1. [High-Level Overview](#high-level-overview)
2. [Detailed Data Flow](#detailed-data-flow)
3. [Event Processing Pipeline](#event-processing-pipeline)
4. [Caching Architecture](#caching-architecture)
5. [Execution Flow](#execution-flow)

---

## High-Level Overview

```
╔════════════════════════════════════════════════════════════════════════════════════╗
║                          ARBITRAGE SYSTEM DATA FLOW                                ║
╠════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                    ║
║  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐          ║
║  │ BLOCKCHAINS │    │   MEMPOOL   │    │   BRIDGES   │    │  EXTERNAL   │          ║
║  │ (11 chains) │    │ (bloXroute) │    │  (5 active) │    │    APIs     │          ║
║  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘          ║
║         │                  │                  │                  │                 ║
║         ▼                  ▼                  ▼                  ▼                 ║
║  ╔════════════════════════════════════════════════════════════════════════════╗    ║
║  ║                       LAYER 1: INGESTION                                   ║    ║
║  ║  ┌──────────────────────────────────────────────────────────────────────┐  ║    ║
║  ║  │ P1: Asia-Fast   P2: L2-Turbo   P3: High-Value   P4: Solana           │  ║    ║
║  ║  │ BSC/Poly/Avax   Arb/OP/Base    ETH/zkSync/Linea SOL                  │  ║    ║
║  ║  │       │              │               │              │                │  ║    ║
║  ║  │       └──────────────┴───────────────┴──────────────┘                │  ║    ║
║  ║  │                             │                                        │  ║    ║
║  ║  │                   ┌─────────┴─────────┐                              │  ║    ║
║  ║  │                   │  Mempool Detector │                              │  ║    ║
║  ║  │                   │    (Pre-block)    │                              │  ║    ║
║  ║  └───────────────────┴───────────────────┴──────────────────────────────┘  ║    ║
║  ╚════════════════════════════════════════════════════════════════════════════╝    ║
║                                      │                                             ║
║                                      ▼                                             ║
║  ╔════════════════════════════════════════════════════════════════════════════╗    ║
║  ║                   REDIS STREAMS (Event Backbone)                           ║    ║
║  ║  ┌──────────────────────────────────────────────────────────────────────┐  ║    ║
║  ║  │ stream:price-updates │ stream:whale-alerts │ stream:volume-aggregates│  ║    ║
║  ║  │      (~50/sec)       │      (~5/hour)      │       (~20/min)         │  ║    ║
║  ║  └──────────────────────────────────────────────────────────────────────┘  ║    ║
║  ╚════════════════════════════════════════════════════════════════════════════╝    ║
║                                      │                                             ║
║                                      ▼                                             ║
║  ╔════════════════════════════════════════════════════════════════════════════╗    ║
║  ║                       LAYER 2: ANALYSIS                                    ║    ║
║  ║  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐                  ║    ║
║  ║  │  Cross-Chain   │ │   Multi-Leg    │ │     Whale      │                  ║    ║
║  ║  │   Analyzer     │ │  Path Finder   │ │    Tracker     │                  ║    ║
║  ║  └───────┬────────┘ └───────┬────────┘ └───────┬────────┘                  ║    ║
║  ║          │                  │                  │                           ║    ║
║  ║  ┌───────┴────────┐ ┌───────┴────────┐ ┌───────┴────────┐                  ║    ║
║  ║  │   Liquidity    │ │  ML Predictor  │ │  Correlation   │                  ║    ║
║  ║  │ Depth Analyzer │ │   (LSTM/EMA)   │ │   Analyzer     │                  ║    ║
║  ║  └───────┬────────┘ └───────┬────────┘ └───────┬────────┘                  ║    ║
║  ╚══════════╪══════════════════╪══════════════════╪═══════════════════════════╝    ║
║             └──────────────────┴──────────────────┘                                ║
║                                 │                                                  ║
║                                 ▼                                                  ║
║  ╔════════════════════════════════════════════════════════════════════════════╗    ║
║  ║                       LAYER 3: DECISION                                    ║    ║
║  ║  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐                  ║    ║
║  ║  │  Opportunity   │─│   MEV Risk     │─│   Execution    │                  ║    ║
║  ║  │    Scorer      │ │   Analyzer     │ │    Planner     │                  ║    ║
║  ║  │  (Kelly Crit.) │ │ (Sandwich Chk) │ │ (Route Optim.) │                  ║    ║
║  ║  └───────┬────────┘ └───────┬────────┘ └───────┬────────┘                  ║    ║
║  ╚══════════╪══════════════════╪══════════════════╪═══════════════════════════╝    ║
║             └──────────────────┴──────────────────┘                                ║
║                                 │                                                  ║
║                                 ▼                                                  ║
║  ╔════════════════════════════════════════════════════════════════════════════╗    ║
║  ║             stream:opportunities (~10/min) → COORDINATOR                   ║    ║
║  ║                            │                                               ║    ║
║  ║         Leader Election + Pre-Exec Filters + Risk Limits                   ║    ║
║  ║                            │                                               ║    ║
║  ║             stream:execution-requests (~10/min)                            ║    ║
║  ╚════════════════════════════╪═══════════════════════════════════════════════╝    ║
║                               │                                                    ║
║                               ▼                                                    ║
║  ╔════════════════════════════════════════════════════════════════════════════╗    ║
║  ║                       LAYER 4: EXECUTION                                   ║    ║
║  ║  ┌──────────────────────────────────────────────────────────────────────┐  ║    ║
║  ║  │                     EXECUTION ENGINE                                 │  ║    ║
║  ║  │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐      │  ║    ║
║  ║  │ │ Simulation  │▶│  Strategy   │▶│MEV Provider│▶│   Submit   │      │  ║    ║
║  ║  │ │  Service    │ │  Factory    │ │  Factory    │ │Transaction  │      │  ║   ║
║  ║  │ │(Tenderly/   │ │(Intra/Cross/│ │(Flashbots/  │ │             │      │  ║   ║
║  ║  │ │ Helius)     │ │ FlashLoan)  │ │ Jito/L2)    │ │             │      │  ║   ║
║  ║  │ └─────────────┘ └─────────────┘ └─────────────┘ └──────┬──────┘      │  ║   ║
║  ║  │                                                        │             │  ║   ║
║  ║  │ ┌──────────────────────────────────────────────────────┘             │  ║   ║
║  ║  │ │ Circuit Breaker (5 failures → OPEN → 5min cooldown)                │  ║   ║
║  ║  └─┴────────────────────────────────────────────────────────────────────┘  ║   ║
║  ╚════════════════════════════════════════════════════════════════════════════╝   ║
║                                 │                                                  ║
║                                 ▼                                                  ║
║  ┌──────────────────────────────────────────────────────────────────────────────┐  ║
║  │                        BLOCKCHAIN NETWORKS                                   │  ║
║  │  EVM: Flashbots/Private Pools    │    Solana: Jito Bundles                   │  ║
║  └──────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                    ║
╚════════════════════════════════════════════════════════════════════════════════════╝
```

---

## Detailed Data Flow

### Price Update Flow (Critical Path - Target: <50ms)

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                          PRICE UPDATE CRITICAL PATH                              │
│                              Target: <50ms E2E                                   │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  BLOCKCHAIN                                                                      │
│      │                                                                           │
│      │ WebSocket Event (Sync)                                                    │
│      │ ─────────────────────                                                     │
│      ▼ <5ms                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────┐  │
│  │ PARTITION DETECTOR                                                         │  │
│  │                                                                            │  │
│  │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐     │  │
│  │  │   Decode    │──▶│  Update L1  │──▶│   Check     │──▶│  Publish   │    │  │
│  │  │  Sync Log   │   │   Cache     │   │  Arbitrage  │   │ to Stream   │     │  │
│  │  │             │   │(SharedArray)│   │             │   │             │     │  │
│  │  └─────────────┘   └─────────────┘   └─────────────┘   └─────────────┘     │  │
│  │       <1ms              <1ms              <5ms             <2ms            │  │
│  │                                                                            │  │
│  │  Price Matrix: O(1) indexed structure                                      │  │
│  │  Token Pair Lookup: Normalized key → Map<string, Pair[]>                   │  │
│  │  Memory: Float64Array (not objects) - 60% savings                          │  │
│  └────────────────────────────────────────────────────────────────────────────┘  │
│               │                                                                  │
│               │ stream:price-updates                                             │
│               ▼                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────┐  │
│  │ CROSS-CHAIN ANALYZER                                                       │  │
│  │                                                                            │  │
│  │  ┌──────────────────────────────────────────────────────────────────────┐  │  │
│  │  │ Materialized Price Matrix                                            │  │  │
│  │  │                                                                      │  │  │
│  │  │  Chain A ───┐    Compare Prices     ┌─── Opportunity?                │  │  │
│  │  │             ├───────────────────────┤                                │  │  │
│  │  │  Chain B ───┘    O(1) per pair      └─── If yes → Score & Publish    │  │  │
│  │  │                                                                      │  │  │
│  │  └──────────────────────────────────────────────────────────────────────┘  │  │
│  │       <100ms cross-chain detection                                         │  │
│  └────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  LATENCY BUDGET BREAKDOWN:                                                       │
│  ┌──────────────────────────────────────────────────────────────────────────┐    │
│  │ WebSocket Receive: 5ms │ Decode: 1ms │ L1 Update: 1ms │ Detection: 5ms   │    │
│  │ Redis Publish:    10ms │ Cross-Chain: 20ms │ Total Same-Chain: <25ms     │    │
│  └──────────────────────────────────────────────────────────────────────────┘    │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## Event Processing Pipeline

### Swap Event Smart Filtering

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                        SWAP EVENT FILTERING PIPELINE                             │
│                      99% Redis reduction, 100% signal retention                  │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  BLOCKCHAIN SWAP EVENTS                                                          │
│          │                                                                       │
│          │ ~10,000 events/min                                                    │
│          ▼                                                                       │
│  ┌────────────────────────────────────────────────────────────────────────────┐  │
│  │ LEVEL 1: EDGE FILTER                                      90% REJECTED     │  │
│  │ ─────────────────────                                                      │  │
│  │                                                                            │  │
│  │  ┌─────────────────┐        ┌─────────────────┐                            │  │
│  │  │ In watchlist?   │──NO───▶│      DROP       │                           │  │
│  │  └────────┬────────┘        └─────────────────┘                            │  │
│  │           │ YES                                                            │  │
│  │           ▼                                                                │  │
│  │  ┌─────────────────┐        ┌─────────────────┐                            │  │
│  │  │Recent duplicate?│──YES──▶│      DROP       │                           │  │
│  │  └────────┬────────┘        └─────────────────┘                            │  │
│  │           │ NO                                                             │  │
│  │           ▼                                                                │  │
│  └────────────────────────────────────────────────────────────────────────────┘  │
│          │                                                                       │
│          │ ~1,000 events/min                                                     │
│          ▼                                                                       │
│  ┌────────────────────────────────────────────────────────────────────────────┐  │
│  │ LEVEL 2: VALUE FILTER                                     93% REJECTED     │  │
│  │ ─────────────────────                                                      │  │
│  │                                                                            │  │
│  │  ┌──────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                                                                      │  │  │
│  │  │  USD Value         Action            Destination                     │  │  │
│  │  │  ──────────        ──────            ───────────                     │  │  │
│  │  │  < $10K    ───────▶ Sample 1%  ────▶ Local Aggregation              │  │  │
│  │  │  $10K-$50K ───────▶ Process    ────▶ Volume Aggregates              │  │  │
│  │  │  > $50K    ───────▶ IMMEDIATE  ────▶ stream:whale-alerts            │  │  │
│  │  │                                                                      │  │  │
│  │  └──────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                            │  │
│  └────────────────────────────────────────────────────────────────────────────┘  │
│          │                                                                       │
│          │ ~70 events/min                                                        │
│          ▼                                                                       │
│  ┌────────────────────────────────────────────────────────────────────────────┐  │
│  │ LEVEL 3: LOCAL AGGREGATION                              BATCH PUBLISH      │  │
│  │ ──────────────────────────                                                 │  │
│  │                                                                            │  │
│  │  ┌──────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                         5-Second Window                              │  │  │
│  │  │                                                                      │  │  │
│  │  │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                 │  │  │
│  │  │  │  Aggregate  │   │ Track MEV   │   │   Batch     │                 │  │  │
│  │  │  │ Volume/Pair │   │ Bot Patterns│   │  Publish    │                 │  │  │
│  │  │  └─────────────┘   └─────────────┘   └──────┬──────┘                 │  │  │
│  │  │                                             │                        │  │  │
│  │  └─────────────────────────────────────────────┼────────────────────────┘  │  │
│  │                                                │                           │  │
│  └────────────────────────────────────────────────┼───────────────────────────┘  │
│                                                   │                              │
│                                                   ▼                              │
│                                      stream:volume-aggregates                    │
│                                           (~20/min)                              │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## Caching Architecture

### Three-Tier Hierarchical Cache

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                      HIERARCHICAL CACHE ARCHITECTURE                             │
│                           ADR-005 Implementation                                 │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ╔══════════════════════════════════════════════════════════════════════════╗    │
│  ║  L1 CACHE: SharedArrayBuffer (Per-Instance)                              ║    │
│  ║  ─────────────────────────────────────────                               ║    │
│  ║                                                                          ║    │
│  ║  Access Time: <0.1ms │ Capacity: 1,000 pairs │ Memory: Float64Array      ║    │
│  ║                                                                          ║    │
│  ║  ┌────────────────────────────────────────────────────────────────────┐  ║    │
│  ║  │                                                                    │  ║    │
│  ║  │  Index    Token Pair           Price        Timestamp    Rsv0      │  ║    │
│  ║  │  ─────    ──────────           ─────        ─────────    ────      │  ║    │
│  ║  │  [0]      WETH/USDC           3245.67       1707134400   1.2e18    │  ║    │
│  ║  │  [1]      WBNB/BUSD            312.45       1707134401   5.6e18    │  ║    │
│  ║  │  [2]      WMATIC/USDT            0.89       1707134399   2.3e18    │  ║    │
│  ║  │  ...                                                               │  ║    │
│  ║  │                                                                    │  ║    │
│  ║  └────────────────────────────────────────────────────────────────────┘  ║    │
│  ║                                                                          ║    │
│  ║  Ring Buffer (Latencies): Float64Array[1000] - Zero allocation           ║    │
│  ║  Normalization Cache: LRU Map<string, string> - 10K entries              ║    │
│  ║                                                                          ║    │
│  ╚══════════════════════════════════════════════════════════════════════════╝    │
│                   │                                                              │
│                   │ MISS                                                         │
│                   ▼                                                              │
│  ╔══════════════════════════════════════════════════════════════════════════╗    │
│  ║  L2 CACHE: Redis (Cross-Partition)                                       ║    │
│  ║  ─────────────────────────────────                                       ║    │
│  ║                                                                          ║    │
│  ║  Access Time: <10ms │ TTL: 30s │ Capacity: Unlimited │ Batched 50:1      ║    │
│  ║                                                                          ║    │
│  ║  ┌────────────────────────────────────────────────────────────────────┐  ║    │
│  ║  │                                                                    │  ║    │
│  ║  │  KEY                           VALUE                       TTL     │  ║    │
│  ║  │  ───                           ─────                       ───     │  ║    │
│  ║  │  price:eth:weth-usdc          {"price":3245.67,"ts":...}  30s      │  ║    │
│  ║  │  price:bsc:wbnb-busd          {"price":312.45,"ts":...}   30s      │  ║    │
│  ║  │  gas:ethereum                 {"fast":45,"standard":30}   60s      │  ║    │
│  ║  │  correlation:weth-usdc        ["wbtc-usdc","weth-usdt"]   300s     │  ║    │
│  ║  │                                                                    │  ║    │
│  ║  └────────────────────────────────────────────────────────────────────┘  ║    │
│  ║                                                                          ║    │
│  ╚══════════════════════════════════════════════════════════════════════════╝    │
│                   │                                                              │
│                   │ MISS                                                         │
│                   ▼                                                              │
│  ╔══════════════════════════════════════════════════════════════════════════╗    │
│  ║  L3 CACHE: RPC Call (Blockchain)                                         ║    │
│  ║  ───────────────────────────────                                         ║    │
│  ║                                                                          ║    │
│  ║  Access Time: 50-500ms │ Rate Limited │ Multi-Provider Rotation          ║    │
│  ║                                                                          ║    │
│  ║  ┌────────────────────────────────────────────────────────────────────┐  ║    │
│  ║  │                                                                    │  ║    │
│  ║  │  Token Bucket Rate Limiter (ADR-024)                               │  ║    │
│  ║  │  ─────────────────────────────────────                             │  ║    │
│  ║  │                                                                    │  ║    │
│  ║  │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐               │  ║    │
│  ║  │  │  Provider 1 │   │  Provider 2 │   │  Provider 3 │               │  ║    │
│  ║  │  │  (Alchemy)  │   │  (Infura)   │   │ (QuickNode) │               │  ║    │
│  ║  │  │  10 req/s   │   │  10 req/s   │   │  10 req/s   │               │  ║    │
│  ║  │  └─────────────┘   └─────────────┘   └─────────────┘               │  ║    │
│  ║  │        │                 │                 │                       │  ║    │
│  ║  │        └─────────────────┴─────────────────┘                       │  ║    │
│  ║  │                          │                                         │  ║    │
│  ║  │                   Round-Robin + Failover                           │  ║    │
│  ║  │                                                                    │  ║    │
│  ║  └────────────────────────────────────────────────────────────────────┘  ║    │
│  ║                                                                          ║    │
│  ╚══════════════════════════════════════════════════════════════════════════╝    │
│                                                                                  │
│  CACHE HIT RATES (Expected):                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────┐    │
│  │  L1: >95% (hot pairs)  │  L2: >98% (all pairs)  │  L3: <2% (cold/stale)  │    │
│  └──────────────────────────────────────────────────────────────────────────┘    │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## Execution Flow

### Opportunity to Trade Execution

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                      OPPORTUNITY EXECUTION PIPELINE                              │
│                          Broker Pattern (ADR-002)                                │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ANALYZERS                       COORDINATOR                 EXECUTION ENGINE    │
│  ─────────                       ───────────                 ────────────────    │
│                                                                                  │
│ ┌─────────────┐                                                                  │
│ │ Cross-Chain │──┐                                                               │
│ │  Analyzer   │  │                                                               │
│ └─────────────┘  │                                                               │
│                  │   stream:opportunities                                        │
│ ┌─────────────┐  │        (~10/min)                                              │
│ │  Multi-Leg  │──┼────────────────────────▶┌─────────────────────────────┐      │
│ │ Path Finder │  │                         │                             │      │
│ └─────────────┘  │                         │   COORDINATOR (Leader)      │      │
│                  │                         │                             │      │
│ ┌─────────────┐  │                         │  ┌───────────────────────┐  │      │
│ │     ML      │──┘                         │  │  PRE-EXEC FILTERS     │  │      │
│ │  Predictor  │                            │  │                       │  │      │
│ └─────────────┘                            │  │  □ Leader only?       │  │      │
│                                            │  │  □ Circuit breaker?   │  │      │
│                                            │  │  □ Risk limits OK?    │  │      │
│                                            │  │  □ Not duplicate?     │  │      │
│                                            │  │                       │  │      │
│                                            │  └───────────┬───────────┘  │      │
│                                            │              │              │      │
│                                            │              ▼              │      │
│                                            │  ┌───────────────────────┐  │      │
│                                            │  │  ROUTING DECISION     │  │      │
│                                            │  │                       │  │      │
│                                            │  │  Chain-specific exec? │  │      │
│                                            │  │  Primary or backup?   │  │      │
│                                            │  │  Load balancing?      │  │      │
│                                            │  │                       │  │      │
│                                            │  └───────────┬───────────┘  │      │
│                                            │              │              │      │
│                                            └──────────────┼──────────────┘      │
│                                                           │                     │
│                                     stream:execution-requests                   │
│                                            (~10/min)                            │
│                                                           │                     │
│                                                           ▼                     │
│ ┌────────────────────────────────────────────────────────────────────────────┐  │
│ │                          EXECUTION ENGINE                                  │  │
│ │                                                                            │  │
│ │  ┌──────────────────────────────────────────────────────────────────────┐  │  │
│ │  │  STEP 1: SIMULATION                                                  │  │  │
│ │  │  ──────────────────────                                              │  │  │
│ │  │                                                                      │  │  │
│ │  │  EVM Chains ─────────▶ Tenderly ─▶ Alchemy ─▶ Local (eth_call)     │  │  │
│ │  │  Solana ─────────────▶ Helius API ─▶ Native RPC                     │  │  │
│ │  │                                                                      │  │  │
│ │  │  Output: { success: bool, gasEstimate: bigint, revertReason? }       │  │  │
│ │  └──────────────────────────────────────────────────────────────────────┘  │  │
│ │                          │                                                 │  │
│ │                          │ SUCCESS                                         │  │
│ │                          ▼                                                 │  │
│ │  ┌──────────────────────────────────────────────────────────────────────┐  │  │
│ │  │  STEP 2: STRATEGY SELECTION                                          │  │  │
│ │  │  ──────────────────────────                                          │  │  │
│ │  │                                                                      │  │  │
│ │  │  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐      │  │  │
│ │  │  │ IntraChainStrat  │ │ CrossChainStrat  │ │ FlashLoanStrat   │      │  │  │
│ │  │  │                  │ │                  │ │                  │      │  │  │
│ │  │  │ Same-chain arb   │ │ Bridge required  │ │ Capital-free     │      │  │  │
│ │  │  │ Direct swap      │ │ Buy→Bridge→Sell  │ │ Aave V3 (0.09%)  │      │  │  │
│ │  │  └──────────────────┘ └──────────────────┘ └──────────────────┘      │  │  │
│ │  │                                                                      │  │  │
│ │  └──────────────────────────────────────────────────────────────────────┘  │  │
│ │                          │                                                 │  │
│ │                          ▼                                                 │  │
│ │  ┌──────────────────────────────────────────────────────────────────────┐  │  │
│ │  │  STEP 3: MEV PROTECTION                                              │  │  │
│ │  │  ──────────────────────                                              │  │  │
│ │  │                                                                      │  │  │
│ │  │  Ethereum ──────────▶ Flashbots Bundle ──▶ Private mempool          │  │  │
│ │  │  Solana ────────────▶ Jito Bundle ───────▶ Block engine             │  │  │
│ │  │  L2 Rollups ────────▶ Sequencer Direct ──▶ Priority fee             │  │  │
│ │  │  BSC/Polygon ───────▶ Private Pool ──────▶ Standard gas             │  │  │
│ │  │                                                                      │  │  │
│ │  └──────────────────────────────────────────────────────────────────────┘  │  │
│ │                          │                                                 │  │
│ │                          ▼                                                 │  │
│ │  ┌──────────────────────────────────────────────────────────────────────┐  │  │
│ │  │  STEP 4: SUBMIT & MONITOR                                            │  │  │
│ │  │  ────────────────────────                                            │  │  │
│ │  │                                                                      │  │  │
│ │  │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                 │  │  │
│ │  │  │   Submit    │──▶│   Monitor   │──▶│    ACK      │                │  │  │
│ │  │  │Transaction  │   │ Confirmation│   │  Message    │                 │  │  │
│ │  │  └─────────────┘   └─────────────┘   └─────────────┘                 │  │  │
│ │  │                                             │                        │  │  │
│ │  │                           ┌─────────────────┴─────────────────┐      │  │  │
│ │  │                           │                                   │      │  │  │
│ │  │                           ▼                                   ▼      │  │  │
│ │  │                    ┌─────────────┐                     ┌─────────┐   │  │  │
│ │  │                    │   SUCCESS   │                     │ FAILURE │   │  │  │
│ │  │                    │             │                     │         │   │  │  │
│ │  │                    │ ACK + Log   │                     │ACK + DLQ│   │  │  │
│ │  │                    │ profit      │                     │+CirBrk  │   │  │  │
│ │  │                    └─────────────┘                     └─────────┘   │  │  │
│ │  │                                                                      │  │  │
│ │  └──────────────────────────────────────────────────────────────────────┘  │  │
│ │                                                                            │  │
│ │  CIRCUIT BREAKER STATE MACHINE:                                            │  │
│ │  ┌──────────────────────────────────────────────────────────────────────┐  │  │
│ │  │                                                                      │  │  │
│ │  │   CLOSED ──(5 failures)──▶ OPEN ──(5 min)──▶ HALF_OPEN ──(3 ok)──┐  │  │  │
│ │  │      ▲                                                            │  │  │  │
│ │  │      └────────────────────────────────────────────────────────────┘  │  │  │
│ │  │                                                                      │  │  │
│ │  └──────────────────────────────────────────────────────────────────────┘  │  │
│ │                                                                            │  │
│ └────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Redis Streams Summary

| Stream | Producer | Consumer | Volume | Retention |
|--------|----------|----------|--------|-----------|
| `stream:price-updates` | Partition Detectors | Cross-Chain, Dashboard | ~50/sec | 1 hour |
| `stream:opportunities` | Analyzers | Coordinator | ~10/min | 24 hours |
| `stream:execution-requests` | Coordinator | Execution Engine | ~10/min | 24 hours |
| `stream:whale-alerts` | Detectors | All Services | ~5/hour | 24 hours |
| `stream:volume-aggregates` | Detectors | Analyzer | ~20/min | 1 hour |
| `stream:pending-opportunities` | Mempool Detector | Cross-Chain | ~100/min | 1 hour |
| `stream:health` | All Services | Coordinator | ~10/min | 1 hour |
| `stream:dead-letter-queue` | All Services | Ops/Monitoring | ~1/hour | 7 days |

---

## Performance Metrics

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                        SYSTEM PERFORMANCE TARGETS                                │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  LATENCY TARGETS                          THROUGHPUT TARGETS                     │
│  ───────────────                          ──────────────────                     │
│                                                                                  │
│  Same-chain detection:    <50ms           Events processed:     ~1000/sec        │
│  Cross-chain detection:   <100ms          Opportunities/day:    500+             │
│  Execution submission:    <200ms          Executions/day:       50+              │
│  Bridge opportunity:      <10s            Redis commands/day:   <10K             │
│                                                                                  │
│  RELIABILITY TARGETS                      PROFITABILITY TARGETS                  │
│  ───────────────────                      ─────────────────────                  │
│                                                                                  │
│  System uptime:           99.9%           Execution success:    85%+             │
│  MTTR:                    <5 min          Avg profit/trade:     0.3%+            │
│  Data loss:               0               Win rate:             70%+             │
│  False positives:         <5%             Infrastructure cost:  $0/month         │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

---

## Related Documentation

- [Architecture Overview](ARCHITECTURE_V2.md) - Complete system architecture
- [Current State](CURRENT_STATE.md) - Implementation status
- [ADR-002: Redis Streams](adr/ADR-002-redis-streams.md) - Message broker decision
- [ADR-005: Hierarchical Cache](adr/ADR-005-hierarchical-cache.md) - Caching strategy
- [ADR-022: Hot-Path Optimization](adr/ADR-022-hot-path-memory-optimization.md) - Performance patterns
