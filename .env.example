# =============================================================================
# Environment Configuration Template
# =============================================================================
# SETUP INSTRUCTIONS:
# 1. Copy this file: cp .env.example .env.local
# 2. Fill in your API keys and configuration
# 3. NEVER commit .env or .env.local to git!
#
# For production: Use a secrets manager (AWS Secrets Manager, HashiCorp Vault)
# For CI/CD: Use GitHub Secrets or your CI provider's secret management
# =============================================================================

# -----------------------------------------------------------------------------
# Node Environment
# -----------------------------------------------------------------------------
NODE_ENV=development
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
# For local Docker development, use password from REDIS_PASSWORD (default: localdev)
# For production Docker, use password from REDIS_PASSWORD (default: changeme - CHANGE THIS!)
REDIS_URL=redis://:localdev@localhost:6379
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=localdev

# -----------------------------------------------------------------------------
# Service Ports
# -----------------------------------------------------------------------------
COORDINATOR_PORT=3000
P1_ASIA_FAST_PORT=3001
P2_L2_TURBO_PORT=3002
P3_HIGH_VALUE_PORT=3003
P4_SOLANA_PORT=3004
# NOTE: Fly.io deployments use PORT=8080 (Fly's internal_port).
# The code reads EXECUTION_ENGINE_PORT first, then falls back to PORT.
# Local dev uses 3005; Fly.io uses 8080 via fly.toml internal_port setting.
EXECUTION_ENGINE_PORT=3005
CROSS_CHAIN_DETECTOR_PORT=3006
UNIFIED_DETECTOR_PORT=3007
MEMPOOL_DETECTOR_PORT=3008

# -----------------------------------------------------------------------------
# Mempool Detection (Optional - requires bloXroute BDN access)
# -----------------------------------------------------------------------------
# Run with: npm run dev:mempool or npm run dev:mempool:fast
# Requires BLOXROUTE_AUTH_HEADER (configured in MEV Protection section below)
# Currently supports Ethereum and BSC mempool feeds
# MEMPOOL_DETECTION_ENABLED=false
# BLOXROUTE_WS_ENDPOINT=wss://eth.blxrbdn.com/ws
# BLOXROUTE_BSC_WS_ENDPOINT=wss://bsc.blxrbdn.com/ws

# -----------------------------------------------------------------------------
# Partition Configuration
# -----------------------------------------------------------------------------
PARTITION_ID=asia-fast
INSTANCE_ID=local-dev-1
REGION_ID=local

# =============================================================================
# OpenTelemetry (Centralized Log Aggregation - O-3)
# =============================================================================
# When OTEL_EXPORTER_ENDPOINT is set, all Pino logs are also exported to the
# OTEL collector via OTLP/HTTP. Trace context (traceId, spanId) is injected
# into log records for cross-service correlation.
#
# SETUP:
# 1. Deploy an OTEL collector (e.g., otel/opentelemetry-collector-contrib)
# 2. Set OTEL_EXPORTER_ENDPOINT to the collector's OTLP/HTTP endpoint
# 3. Set OTEL_SERVICE_NAME to identify this service in the collector
#
# OTEL_EXPORTER_ENDPOINT=http://otel-collector:4318
# OTEL_SERVICE_NAME=arbitrage-coordinator
# OTEL_BATCH_SIZE=50
# OTEL_FLUSH_INTERVAL_MS=5000

# =============================================================================
# RPC PROVIDER API KEYS
# =============================================================================
# Sign up for free tiers at each provider and add your keys below.
# See docs/reports/RPC_DEEP_DIVE_ANALYSIS.md for full strategy

# dRPC (https://drpc.org/)
DRPC_API_KEY=

# Ankr (https://www.ankr.com/rpc/)
ANKR_API_KEY=

# Infura (https://infura.io/)
INFURA_API_KEY=

# Alchemy (https://www.alchemy.com/)
ALCHEMY_API_KEY=

# QuickNode (https://www.quicknode.com/)
QUICKNODE_API_KEY=

# Helius - Solana (https://helius.xyz/)
HELIUS_API_KEY=

# Triton - Solana (https://triton.one/)
TRITON_API_KEY=

# Optional providers for extra redundancy
# BLAST_API_KEY=
# BLOCKPI_API_KEY=

# =============================================================================
# Per-Chain RPC URL Overrides (Optional)
# =============================================================================
# Leave commented to use API key-based URLs (recommended)
# Only uncomment if you need to force a specific endpoint

# ETHEREUM_RPC_URL=
# ETHEREUM_WS_URL=
# ARBITRUM_RPC_URL=
# ARBITRUM_WS_URL=
# BSC_RPC_URL=
# BSC_WS_URL=
# BASE_RPC_URL=
# BASE_WS_URL=
# POLYGON_RPC_URL=
# POLYGON_WS_URL=
# OPTIMISM_RPC_URL=
# OPTIMISM_WS_URL=
# AVALANCHE_RPC_URL=
# AVALANCHE_WS_URL=
# FANTOM_RPC_URL=
# FANTOM_WS_URL=
# ZKSYNC_RPC_URL=
# ZKSYNC_WS_URL=
# LINEA_RPC_URL=
# LINEA_WS_URL=
# SOLANA_RPC_URL=
# SOLANA_WS_URL=
# SOLANA_DEVNET_RPC_URL=https://api.devnet.solana.com

# =============================================================================
# Simulation Mode (For Testing)
# =============================================================================
SIMULATION_MODE=true
SIMULATION_VOLATILITY=0.02
SIMULATION_UPDATE_INTERVAL_MS=5000
SIMULATION_MIN_PROFIT=50
SIMULATION_TIME_CRITICAL_MS=2000

# Execution simulation (no real blockchain transactions)
EXECUTION_SIMULATION_MODE=true
# DANGER: Override to allow simulation mode in production (NODE_ENV=production).
# Without this, the engine throws a CRITICAL error to prevent capital drain.
# SIMULATION_MODE_PRODUCTION_OVERRIDE=true
EXECUTION_SIMULATION_SUCCESS_RATE=0.85
EXECUTION_SIMULATION_LATENCY_MS=500
EXECUTION_SIMULATION_GAS_USED=200000
EXECUTION_SIMULATION_GAS_COST_MULTIPLIER=0.1
EXECUTION_SIMULATION_PROFIT_VARIANCE=0.2
EXECUTION_SIMULATION_LOG=true

# =============================================================================
# Arbitrage Configuration
# =============================================================================
MIN_PROFIT_PERCENTAGE=0.003
CONFIDENCE_THRESHOLD=0.75
MAX_GAS_PRICE_GWEI=50
CROSS_CHAIN_ENABLED=true
TRIANGULAR_ENABLED=true
# Maximum depth for triangular arbitrage detection (how many hops to search)
# Note: Contracts support up to MAX_SWAP_HOPS=5, but detection limited to 3 for performance
# Increase to 5 if willing to accept higher latency in opportunity detection
MAX_TRIANGULAR_DEPTH=3
OPPORTUNITY_EXPIRY_MS=1000

# =============================================================================
# Coordinator Configuration
# =============================================================================
IS_STANDBY=false
CAN_BECOME_LEADER=true
LEADER_LOCK_KEY=coordinator:leader:lock
MAX_OPPORTUNITIES=1000
OPPORTUNITY_TTL_MS=60000
OPPORTUNITY_CLEANUP_INTERVAL_MS=10000
PAIR_TTL_MS=300000
MAX_ACTIVE_PAIRS=10000
ALERT_COOLDOWN_MS=300000
# OP-22: Execution circuit breaker thresholds
EXECUTION_CB_THRESHOLD=5
EXECUTION_CB_RESET_MS=60000
# OP-23: API rate limits (requests per window)
API_RATE_LIMIT_WINDOW_MS=900000
API_RATE_LIMIT_MAX=100
# OP-31: Dashboard authentication token (required in production)
# DASHBOARD_AUTH_TOKEN=generate-a-secure-random-string-here
# OP-31: Instance role ('primary' | 'standby')
INSTANCE_ROLE=primary

# =============================================================================
# Execution Engine Configuration
# =============================================================================
EXECUTION_TIMEOUT_MS=55000
TRANSACTION_TIMEOUT_MS=50000
SHUTDOWN_TIMEOUT_MS=5000
PROVIDER_CONNECTIVITY_TIMEOUT_MS=5000
PROVIDER_HEALTH_CHECK_TIMEOUT_MS=5000
PROVIDER_RECONNECTION_TIMEOUT_MS=10000
QUEUE_PAUSED_ON_START=false
HEALTH_CHECK_INTERVAL_MS=10000
FAILOVER_THRESHOLD=3
FAILOVER_TIMEOUT_MS=60000
LEADER_HEARTBEAT_INTERVAL_MS=10000
LEADER_LOCK_TTL_MS=30000

# Nonce pool pre-allocation for concurrent transaction submission
# Pool maintains a buffer of pre-fetched nonces to avoid sequential RPC calls
# NONCE_POOL_SIZE: Number of nonces to pre-allocate (code default: 5, production recommended: 100)
# NONCE_POOL_REPLENISH_THRESHOLD: Refill when pool drops below this count (code default: 2, production recommended: 20)
NONCE_POOL_SIZE=100
NONCE_POOL_REPLENISH_THRESHOLD=20

# =============================================================================
# RPC Request Batching (Phase 3 Optimization)
# =============================================================================
# Enable JSON-RPC 2.0 batch requests to reduce HTTP overhead
# See RPC_DATA_OPTIMIZATION_IMPLEMENTATION_PLAN.md Phase 3
RPC_BATCHING_ENABLED=false
RPC_BATCH_MAX_SIZE=10
RPC_BATCH_TIMEOUT_MS=10
RPC_BATCH_MAX_QUEUE=100

# =============================================================================
# Circuit Breaker Configuration
# =============================================================================
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_COOLDOWN_MS=300000
CIRCUIT_BREAKER_HALF_OPEN_ATTEMPTS=1

# =============================================================================
# MEV PROTECTION CONFIGURATION
# =============================================================================
# Protects arbitrage transactions from front-running and MEV attacks across
# supported chains using chain-appropriate strategies.
#
# CHAINS SUPPORTED:
# - Ethereum: Flashbots/MEV-Share (private relay with rebate capture)
# - BSC: BloXroute (private mempool submission)
# - Polygon: Fastlane (MEV-protected ordering)
# - L2s: Inherent sequencer protection (Arbitrum, Optimism, Base, zkSync, Linea)
#
# See docs/CONFIGURATION.md for detailed setup guide.
# =============================================================================

# Global MEV Protection Toggle
# When disabled, all transactions use public mempool regardless of chain
MEV_PROTECTION_ENABLED=false

# MEV Protection Settings
MEV_SUBMISSION_TIMEOUT_MS=30000    # Timeout for protected submission (30s)
MEV_MAX_RETRIES=3                  # Maximum retry attempts
MEV_FALLBACK_TO_PUBLIC=true        # Fallback to public mempool if private submission fails
MEV_SIMULATE_BEFORE_SUBMIT=true    # Simulate transactions before submission (recommended)

# -----------------------------------------------------------------------------
# Ethereum: Flashbots & MEV-Share Configuration
# -----------------------------------------------------------------------------
# SETUP INSTRUCTIONS:
# 1. Generate a Flashbots auth key (any Ethereum private key):
#    node -e "console.log(require('ethers').Wallet.createRandom().privateKey)"
# 2. Set FLASHBOTS_AUTH_KEY to the generated key
# 3. Enable MEV-Share (FEATURE_MEV_SHARE=true) to capture 50-90% MEV value as rebates
#
# FLASHBOTS_AUTH_KEY=0x1234...your-private-key-here
FLASHBOTS_AUTH_KEY=
FLASHBOTS_RELAY_URL=https://relay.flashbots.net

# MEV-Share: Capture 50-90% of MEV value as rebates (Task 1.1 - Completed)
# When enabled: Uses MEV-Share endpoint with hint configuration
# When disabled: Falls back to standard Flashbots (no rebates)
# Default: true (MEV-Share enabled for value capture)
# @see ADR-028: MEV-Share Integration
# @see docs/architecture/adr/ADR-028-mev-share-integration.md
FEATURE_MEV_SHARE=true

# -----------------------------------------------------------------------------
# BSC: BloXroute Configuration (Task 1.3)
# -----------------------------------------------------------------------------
# SETUP INSTRUCTIONS:
# 1. Sign up at https://bloxroute.com/
# 2. Navigate to your dashboard and copy your authorization header
# 3. Set BLOXROUTE_AUTH_HEADER below
#
# FEATURES:
# - Private mempool submission (prevents front-running on BSC)
# - Automatic fallback to public RPC if BloXroute unavailable
# - Metrics tracking for observability
#
# EXAMPLE:
# BLOXROUTE_AUTH_HEADER=YOUR_BLOXROUTE_AUTH_HEADER_FROM_DASHBOARD
BLOXROUTE_AUTH_HEADER=
BLOXROUTE_URL=https://mev.api.blxrbdn.com

# -----------------------------------------------------------------------------
# Polygon: Fastlane Configuration (Task 1.3)
# -----------------------------------------------------------------------------
# SETUP INSTRUCTIONS:
# 1. No API key required - uses public Fastlane RPC endpoint
# 2. Enable MEV_PROTECTION_ENABLED=true to activate
#
# FEATURES:
# - MEV-protected transaction ordering on Polygon
# - Priority inclusion through Fastlane RPC
# - Automatic fallback to public RPC if Fastlane unavailable
# - Metrics tracking for observability
#
# NOTE: Fastlane is a public endpoint - no auth header needed
FASTLANE_URL=https://fastlane-rpc.polygon.technology

# -----------------------------------------------------------------------------
# Adaptive Risk Scoring (Task 3.2)
# -----------------------------------------------------------------------------
# OVERVIEW:
# Tracks sandwich attacks and dynamically adjusts MEV risk thresholds
# based on historical attack patterns per chain + DEX combination.
#
# BEHAVIOR WHEN ENABLED:
# - Records confirmed sandwich attacks to Redis
# - After 5+ attacks in 24h: Reduces thresholds by 30% (more conservative)
# - Gradually decays back to defaults at 10% per day when attacks stop
# - Uses Redis for storage (free-tier compatible: ~1MB, 10K events max)
#
# SETUP INSTRUCTIONS:
# 1. Enable feature flag: FEATURE_ADAPTIVE_RISK_SCORING=true
# 2. Ensure Redis is running (required for attack tracking)
# 3. Monitor attack patterns via getAllAdjustments() API
#
# STORAGE:
# - Redis keys: adaptive:sandwich_attacks, adaptive:threshold_adjustments:{chain}:{dex}
# - FIFO pruning: Oldest events removed when exceeding maxEvents
# - 7-day retention with automatic cleanup
#
# REFERENCE:
# @see docs/research/FLASHLOAN_MEV_IMPLEMENTATION_PLAN.md Task 3.2
# @see shared/core/src/mev-protection/adaptive-threshold.service.ts
#
FEATURE_ADAPTIVE_RISK_SCORING=false       # Enable adaptive threshold adjustments
ADAPTIVE_ATTACK_THRESHOLD=5               # Attacks needed to trigger adaptation
ADAPTIVE_ACTIVE_WINDOW_HOURS=24           # Time window for counting attacks (hours)
ADAPTIVE_REDUCTION_PERCENT=0.30           # Threshold reduction (30% = 0.30)
ADAPTIVE_DECAY_RATE_PER_DAY=0.10          # Daily decay rate (10% = 0.10)
ADAPTIVE_MAX_EVENTS=10000                 # Max stored events (FIFO pruning)
ADAPTIVE_RETENTION_DAYS=7                 # Event retention period (days)

# -----------------------------------------------------------------------------
# Validation
# -----------------------------------------------------------------------------
# Run validation script to check MEV configuration:
#   npm run validate:mev-setup
#
# The script will verify:
# - Required API keys are configured for each enabled chain
# - URLs are properly formatted
# - Strategy mappings are correct
# =============================================================================

# =============================================================================
# ML / TensorFlow Configuration
# =============================================================================
# TensorFlow.js backend selection for ML models (LSTMPredictor, OrderflowPredictor)
# Backends: cpu (default in dev), wasm (default in prod), tensorflow (native, fastest)
# Note: 'tensorflow' requires @tensorflow/tfjs-node native addon to be installed
# TF_FORCE_BACKEND=cpu

# Enable native TensorFlow backend in production (requires @tensorflow/tfjs-node)
# When true + NODE_ENV=production: Uses 'tensorflow' backend for best performance
# When false + NODE_ENV=production: Uses 'wasm' backend (no native dependency)
# TF_ENABLE_NATIVE=false

# =============================================================================
# Gas Price Limits per Chain (in Gwei)
# =============================================================================
GAS_PRICE_ETHEREUM_GWEI=50
GAS_PRICE_ARBITRUM_GWEI=0.1
GAS_PRICE_OPTIMISM_GWEI=0.001
GAS_PRICE_BASE_GWEI=0.001
GAS_PRICE_POLYGON_GWEI=35
GAS_PRICE_BSC_GWEI=3
GAS_PRICE_AVALANCHE_GWEI=25
GAS_PRICE_FANTOM_GWEI=35
GAS_PRICE_ZKSYNC_GWEI=0.25
GAS_PRICE_LINEA_GWEI=0.5

# =============================================================================
# Cross-Region Health
# =============================================================================
ENABLE_CROSS_REGION_HEALTH=false

# =============================================================================
# Alerts & Notifications (Optional)
# =============================================================================
# DISCORD_WEBHOOK_URL=
# SLACK_WEBHOOK_URL=

# =============================================================================
# Authentication & Security (Optional)
# =============================================================================
# JWT_SECRET=generate-a-secure-random-string-here
# JWT_EXPIRES_IN=1h
# API_KEYS=
# ALLOWED_ORIGINS=http://localhost:3000

# Redis Streams HMAC signing key (S-5: message authentication)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# When set, all Redis Streams messages are signed and verified with HMAC-SHA256.
# When unset, signing is disabled (dev mode).
# STREAM_SIGNING_KEY=
# OP-17: Previous signing key for zero-downtime HMAC key rotation
# Set this to the OLD key when rotating to a new STREAM_SIGNING_KEY.
# Both keys are accepted during the rotation window. Remove after all services restart.
# STREAM_SIGNING_KEY_PREVIOUS=

# Health endpoint auth token (protects /stats endpoint when set)
# When configured, requests to /stats require: Authorization: Bearer <token>
# HEALTH_AUTH_TOKEN=

# Health server bind address (default: 0.0.0.0)
# Set to 127.0.0.1 to restrict health endpoints to localhost only
# HEALTH_BIND_ADDRESS=0.0.0.0

# =============================================================================
# Transaction Simulation (Optional)
# =============================================================================
# TENDERLY_API_KEY=
# TENDERLY_ACCOUNT_SLUG=
# TENDERLY_PROJECT_SLUG=

# =============================================================================
# Feature Flags (Task 1.2: Batched Quoting)
# =============================================================================
# Enable batched quote fetching via MultiPathQuoter contract (default: false)
# When enabled: 75-83% latency reduction (150ms → 50ms for 2-3 hop paths)
# Requires: MultiPathQuoter contract deployed on target chains
# Safe rollout: Start false, enable after deployment validation
# @see ADR-029: Batched Quote Fetching
FEATURE_BATCHED_QUOTER=false

# MultiPathQuoter contract addresses per chain (leave empty if not deployed)
# Deploy with: npx hardhat run scripts/deploy-multi-path-quoter.ts --network <chain>
# MULTI_PATH_QUOTER_ETHEREUM=
# MULTI_PATH_QUOTER_ARBITRUM=
# MULTI_PATH_QUOTER_BASE=
# MULTI_PATH_QUOTER_POLYGON=
# MULTI_PATH_QUOTER_OPTIMISM=
# MULTI_PATH_QUOTER_BSC=

# =============================================================================
# FLASH LOAN AGGREGATOR (Task 2.3)
# =============================================================================
# Enable intelligent flash loan provider selection (default: true for local dev)
# When enabled:
#   - Dynamically selects best provider via weighted ranking (fees 50%, liquidity 30%, reliability 15%, latency 5%)
#   - Validates liquidity with on-chain checks (5-min cache)
#   - Tracks provider metrics (success rate, latency)
#   - Supports fallback on provider failures
# When disabled:
#   - Uses hardcoded Aave V3 provider (backward compatible)
# Local default: true to avoid fallback-provider warning noise during development
# @see docs/research/FLASHLOAN_MEV_IMPLEMENTATION_PLAN.md Phase 2 Task 2.3
FEATURE_FLASH_LOAN_AGGREGATOR=true

# Aggregator weights (must sum to 1.0)
# Defaults: fees=0.5, liquidity=0.3, reliability=0.15, latency=0.05
# Adjust based on priorities (e.g., increase liquidity weight for large trades)
# FLASH_LOAN_AGGREGATOR_WEIGHT_FEES=0.5
# FLASH_LOAN_AGGREGATOR_WEIGHT_LIQUIDITY=0.3
# FLASH_LOAN_AGGREGATOR_WEIGHT_RELIABILITY=0.15
# FLASH_LOAN_AGGREGATOR_WEIGHT_LATENCY=0.05

# Maximum providers to rank per selection (default: 3)
# Higher = more options but slower selection
# FLASH_LOAN_AGGREGATOR_MAX_PROVIDERS=3

# Enable on-chain liquidity validation (default: true if aggregator enabled)
# Validates pool liquidity before execution (prevents insufficient liquidity failures)
# Note: Adds ~10ms latency on cache miss, but prevents failed transactions
# FLASH_LOAN_AGGREGATOR_LIQUIDITY_VALIDATION=true

# Liquidity check threshold in USD (default: 100000)
# Only check liquidity for opportunities above this value
# FLASH_LOAN_AGGREGATOR_LIQUIDITY_THRESHOLD_USD=100000

# =============================================================================
# COMMIT-REVEAL MEV PROTECTION (Task 3.1)
# =============================================================================
# Two-step commit-reveal pattern for advanced MEV protection
# When enabled:
#   - Step 1: Submit commitment hash on-chain (blocks frontrunning)
#   - Step 2: After block confirmation, reveal and execute transaction
#   - Prevents sandwich attacks and frontrunning bots
# When disabled:
#   - Uses standard MEV protection (Flashbots, BloXroute, etc.)
# Safe rollout: Start false, enable after contract deployment
# @see docs/TASK_3.1_COMMIT_REVEAL_IMPLEMENTATION_SUMMARY.md
# =============================================================================

# Global commit-reveal toggle (default: false for local dev)
# Controls whether commit-reveal pattern is used for execution
FEATURE_COMMIT_REVEAL=false

# Redis-based commitment storage (default: false)
# When enabled: Uses Redis for multi-process commitment sharing
# When disabled: Uses in-memory storage (single process only)
# Note: Required for multi-instance deployments
FEATURE_COMMIT_REVEAL_REDIS=false

# Profit validation before reveal (default: true)
# When enabled: Re-validates opportunity profit before revealing
# Prevents revealing unprofitable trades due to market changes
COMMIT_REVEAL_VALIDATE_PROFIT=true

# -----------------------------------------------------------------------------
# Commit-Reveal Contract Addresses per Chain
# -----------------------------------------------------------------------------
# Deploy with: npx hardhat run scripts/deploy-commit-reveal.ts --network <chain>
# Verify zero addresses are not used in production (Issue 1.2)
# Leave empty if commit-reveal not deployed on a specific chain

# Ethereum Mainnet
# COMMIT_REVEAL_CONTRACT_ETHEREUM=

# Layer 2 Networks
# COMMIT_REVEAL_CONTRACT_ARBITRUM=
# COMMIT_REVEAL_CONTRACT_OPTIMISM=
# COMMIT_REVEAL_CONTRACT_BASE=
# COMMIT_REVEAL_CONTRACT_ZKSYNC=
# COMMIT_REVEAL_CONTRACT_LINEA=

# EVM Chains
# COMMIT_REVEAL_CONTRACT_BSC=
# COMMIT_REVEAL_CONTRACT_POLYGON=
# COMMIT_REVEAL_CONTRACT_AVALANCHE=
# COMMIT_REVEAL_CONTRACT_FANTOM=

# =============================================================================
# SYNCSWAP FLASH LOAN PROVIDER (Task 3.4 - zkSync Era)
# =============================================================================
# SyncSwap offers 0.3% flash loans on zkSync Era (best option currently available)
# Deploy with: npx hardhat run scripts/deploy-syncswap.ts --network zksync
# @see contracts/SYNCSWAP_DEPLOYMENT.md
# =============================================================================

# SyncSwap Flash Arbitrage Contract Address (zkSync Era only)
# SYNCSWAP_FLASH_LOAN_CONTRACT_ZKSYNC=

# Emergency script environment variable (for pause/unpause operations)
# Same as SYNCSWAP_FLASH_LOAN_CONTRACT_ZKSYNC, just different name for backwards compatibility
# Used by: scripts/pause-syncswap.ts, scripts/unpause-syncswap.ts
# SYNCSWAP_CONTRACT_ADDRESS=

# Approved DEX routers on zkSync Era (comma-separated)
# Default: SyncSwap Router, Mute.io, Velocore
# ZKSYNC_APPROVED_ROUTERS=0x2da10A1e27bF85cEdD8FFb1AbBe97e53391C0295,0x8B791913eB07C32779a16750e3868aA8495F5964,0x39E098A153Ad69834a9Dac32f0FCa92066aD03f4

# =============================================================================
# CONTRACT DEPLOYMENT CONFIGURATION
# =============================================================================
# Used by Hardhat deployment scripts for contract deployment and verification
# =============================================================================

# Deployer private key (used for deploying contracts)
# WARNING: Use a dedicated deployment wallet with minimal funds
# For production, use a hardware wallet or secrets manager
# DEPLOYER_PRIVATE_KEY=

# Contract owner address (receives ownership after deployment)
# If not set, defaults to deployer address
# For production, use a multisig wallet (Gnosis Safe recommended)
# CONTRACT_OWNER=

# Block explorer API keys (for contract verification)
# Ethereum & Testnets
# ETHERSCAN_API_KEY=

# Arbitrum
# ARBISCAN_API_KEY=

# zkSync Era
# ZKSYNC_ETHERSCAN_API_KEY=

# BSC
# BSCSCAN_API_KEY=

# Polygon
# POLYGONSCAN_API_KEY=

# Optimism
# OPTIMISM_ETHERSCAN_API_KEY=

# Base
# BASESCAN_API_KEY=

# Avalanche
# SNOWTRACE_API_KEY=

# Fantom
# FTMSCAN_API_KEY=

# -----------------------------------------------------------------------------
# Deployment RPC URLs (Optional - falls back to RPC provider configuration)
# -----------------------------------------------------------------------------
# SEPOLIA_RPC_URL=https://rpc.sepolia.org
# ARBITRUM_SEPOLIA_RPC_URL=https://sepolia-rollup.arbitrum.io/rpc
# ZKSYNC_TESTNET_RPC_URL=https://sepolia.era.zksync.dev

# -----------------------------------------------------------------------------
# Gas Reporter Configuration (Optional)
# -----------------------------------------------------------------------------
# Enable gas reporting during tests
# REPORT_GAS=true
# COINMARKETCAP_API_KEY=

# =============================================================================
# Private Keys for Execution (CRITICAL - Use Secrets Manager in Production!)
# =============================================================================
# WARNING: Never store real private keys in .env files!
# For local testing, generate test keys:
#   node -e "console.log(require('ethers').Wallet.createRandom().privateKey)"
#
# For production, use:
#   - AWS Secrets Manager
#   - HashiCorp Vault
#   - Azure Key Vault
#   - Google Secret Manager

# Option A: Per-chain private keys (highest priority — overrides HD derivation)
# ETHEREUM_PRIVATE_KEY=
# BSC_PRIVATE_KEY=
# ARBITRUM_PRIVATE_KEY=
# BASE_PRIVATE_KEY=
# POLYGON_PRIVATE_KEY=
# OPTIMISM_PRIVATE_KEY=

# Option B: HD wallet mnemonic (BIP-44 derivation — unique address per chain)
# Derives per-chain wallets using path m/44'/60'/0'/0/{chainIndex}
# Per-chain private keys above override HD derivation for that chain.
# Solana requires explicit SOLANA_PRIVATE_KEY (non-EVM, different key format).
# WALLET_MNEMONIC=
# WALLET_MNEMONIC_PASSPHRASE=

# =============================================================================
# Detection Pipeline Feature Flags (ML, Sizing, Cross-Chain)
# =============================================================================
# P3-23: These flags control detection pipeline behavior.
# All default to false (opt-in). Enable in order of dependency:
# 1. FEATURE_MOMENTUM_TRACKING → 2. FEATURE_ML_SIGNAL_SCORING → 3. FEATURE_SIGNAL_CACHE_READ
# FEATURE_LIQUIDITY_DEPTH_SIZING is independent.

# Enable destination-chain flash loans for cross-chain arbitrage (default: false)
# When enabled: Uses flash loan on dest chain for atomic sell execution (larger positions, price protection)
# When disabled: Uses direct DEX swap on dest chain
# Trade-off: Flash loan fees (~0.09% Aave) vs atomic execution safety
# FEATURE_DEST_CHAIN_FLASH_LOAN=false

# Enable momentum data recording in detection pipeline (default: false)
# PriceMomentumTracker records price updates from Sync events.
# Prerequisite for FEATURE_ML_SIGNAL_SCORING.
# FEATURE_MOMENTUM_TRACKING=false

# Enable background ML signal pre-computation (default: false)
# Background interval (500ms) pre-computes ML-enhanced confidence scores.
# Requires: FEATURE_MOMENTUM_TRACKING=true for fresh input data.
# FEATURE_ML_SIGNAL_SCORING=false

# Enable hot-path reading of cached ML signal scores (default: false)
# Filters low-confidence opportunities using pre-computed ML scores.
# Requires: FEATURE_ML_SIGNAL_SCORING=true for fresh cached scores.
# FEATURE_SIGNAL_CACHE_READ=false

# Enable liquidity-depth-based optimal trade sizing (default: false)
# LiquidityDepthAnalyzer overrides opportunity.amount with slippage-knee optimal size.
# Independent of ML flags above.
# FEATURE_LIQUIDITY_DEPTH_SIZING=false

# =============================================================================
# PHASE 3: MEASUREMENT & DYNAMIC PRICING (Detection Pipeline)
# =============================================================================
# Dynamic L1 fee estimation via on-chain oracle queries (default: false)
# When enabled, queries ArbGasInfo, OP GasPriceOracle, zks_estimateFee
# to replace static L1_DATA_FEE_USD fallback values
# FEATURE_DYNAMIC_L1_FEES=false
# L1_ORACLE_CACHE_TTL_MS=300000
# L1_ORACLE_REFRESH_INTERVAL_MS=60000

# Orderflow prediction pipeline (default: false)
# Subscribes to stream:pending-opportunities from mempool-detector
# Runs ML predictions and caches for hot-path reads
# Requires: mempool-detector service running (npm run dev:mempool)
# FEATURE_ORDERFLOW_PIPELINE=false
# ORDERFLOW_PREDICTION_CACHE_TTL_MS=30000
# ORDERFLOW_PREDICTION_CACHE_MAX_SIZE=10000
# ORDERFLOW_POLL_INTERVAL_MS=100
# ORDERFLOW_BATCH_SIZE=50

# =============================================================================
# KMS Signing (Phase 2 Item 27)
# =============================================================================
# Enable AWS KMS-based transaction signing (keys never leave HSM)
# Requires: npm install @aws-sdk/client-kms, AWS credentials configured
# KMS key spec: ECC_SECG_P256K1 (secp256k1), usage: SIGN_VERIFY
# FEATURE_KMS_SIGNING=false
#
# Global KMS key ID (ARN, alias, or key ID) — used when per-chain key not set
# KMS_KEY_ID=arn:aws:kms:us-east-1:123456:key/abc-123
#
# Per-chain KMS key IDs (override KMS_KEY_ID for specific chains)
# KMS_KEY_ID_ETHEREUM=
# KMS_KEY_ID_ARBITRUM=
# KMS_KEY_ID_BSC=
# KMS_KEY_ID_BASE=
# KMS_KEY_ID_POLYGON=
# KMS_KEY_ID_OPTIMISM=
# KMS_KEY_ID_AVALANCHE=
# KMS_KEY_ID_FANTOM=
# KMS_KEY_ID_ZKSYNC=
# KMS_KEY_ID_LINEA=
#
# AWS region for KMS API calls (default: us-east-1)
# AWS_REGION=us-east-1

# =============================================================================
# Monolith Mode Configuration
# =============================================================================
# Health server port for the monolith process (default: 3100)
# MONOLITH_HEALTH_PORT=3100
#
# Graceful shutdown timeout for all workers in ms (default: 30000)
# MONOLITH_SHUTDOWN_TIMEOUT_MS=30000
#
# Redis URL override for monolith mode (defaults to REDIS_URL)
# MONOLITH_REDIS_URL=redis://localhost:6379

# =============================================================================
# Price Matrix Configuration (ADR-005)
# =============================================================================
# Number of token pair slots in the SharedArrayBuffer price matrix (default: 1000)
# Higher values = more pairs tracked, but more memory usage
# PRICE_MATRIX_SLOTS=1000

# =============================================================================
# Phase 2 Strategy Feature Flags
# =============================================================================
# Enable backrun strategy for MEV-Share backrunning (default: false)
# When enabled, BackrunStrategy is registered in the strategy factory
# FEATURE_BACKRUN_STRATEGY=false
#
# Enable UniswapX filler strategy (default: false)
# When enabled, UniswapXFillerStrategy fills Dutch auction orders
# FEATURE_UNISWAPX_FILLER=false
#
# Enable MEV-Share backrun event processing (default: false)
# When enabled, connects to MEV-Share SSE stream for backrun opportunities
# FEATURE_MEV_SHARE_BACKRUN=false
#
# Strategy threshold overrides (Fix 9)
# BACKRUN_MIN_PROFIT_USD=0.50
# BACKRUN_MAX_GAS_PRICE_GWEI=80
# UNISWAPX_MIN_PROFIT_USD=1.0
# UNISWAPX_MAX_GAS_PRICE_GWEI=50
